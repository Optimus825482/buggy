<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edge Bildirim Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .info-box p {
            color: #555;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .status.info {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .status.success {
            background: #e8f5e9;
            color: #388e3c;
        }
        
        .status.error {
            background: #ffebee;
            color: #d32f2f;
        }
        
        .status.warning {
            background: #fff3e0;
            color: #f57c00;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .log-entry:last-child {
            border-bottom: none;
        }
        
        .log-time {
            color: #6c757d;
            margin-right: 10px;
        }
        
        .log-level {
            font-weight: bold;
            margin-right: 10px;
        }
        
        .log-level.info { color: #0dcaf0; }
        .log-level.success { color: #198754; }
        .log-level.error { color: #dc3545; }
        .log-level.warn { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”” Edge Bildirim Test</h1>
        <p class="subtitle">Microsoft Edge iÃ§in bildirim izni testi</p>
        
        <div class="info-box">
            <h3>ğŸ“‹ Test AdÄ±mlarÄ±:</h3>
            <p>
                1. "Bildirim Ä°zni Ä°ste" butonuna tÄ±klayÄ±n<br>
                2. Edge'in izin penceresinde "Ä°zin Ver" seÃ§in<br>
                3. "Test Bildirimi GÃ¶nder" ile test edin
            </p>
        </div>
        
        <div id="status" class="status info">
            Durum: HazÄ±r
        </div>
        
        <button onclick="checkSupport()">ğŸ” TarayÄ±cÄ± DesteÄŸini Kontrol Et</button>
        <button onclick="requestPermissionSync()">ğŸ”” Bildirim Ä°zni Ä°ste (Senkron)</button>
        <button onclick="testNotification()">ğŸ“¨ Test Bildirimi GÃ¶nder</button>
        <button onclick="checkPermissionStatus()">ğŸ“Š Ä°zin Durumunu Kontrol Et</button>
        <button onclick="clearLog()">ğŸ—‘ï¸ Logu Temizle</button>
        
        <div id="log" class="log"></div>
    </div>
    
    <script>
        function log(message, level = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString('tr-TR');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <span class="log-time">${time}</span>
                <span class="log-level ${level}">[${level.toUpperCase()}]</span>
                <span>${message}</span>
            `;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(`[${level.toUpperCase()}] ${message}`);
        }
        
        function setStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
            log('Log temizlendi', 'info');
        }
        
        function checkSupport() {
            log('TarayÄ±cÄ± desteÄŸi kontrol ediliyor...', 'info');
            
            // Browser info
            const userAgent = navigator.userAgent;
            const isEdge = /Edg/.test(userAgent);
            const isChrome = /Chrome/.test(userAgent) && !/Edg/.test(userAgent);
            
            log(`User Agent: ${userAgent}`, 'info');
            log(`Edge: ${isEdge ? 'Evet' : 'HayÄ±r'}`, isEdge ? 'success' : 'info');
            log(`Chrome: ${isChrome ? 'Evet' : 'HayÄ±r'}`, isChrome ? 'success' : 'info');
            
            // Notification API
            if ('Notification' in window) {
                log('âœ… Notification API destekleniyor', 'success');
                log(`Mevcut izin durumu: ${Notification.permission}`, 'info');
            } else {
                log('âŒ Notification API desteklenmiyor', 'error');
                setStatus('TarayÄ±cÄ± bildirimleri desteklemiyor', 'error');
                return;
            }
            
            // Service Worker
            if ('serviceWorker' in navigator) {
                log('âœ… Service Worker destekleniyor', 'success');
            } else {
                log('âš ï¸ Service Worker desteklenmiyor', 'warn');
            }
            
            // Push API
            if ('PushManager' in window) {
                log('âœ… Push API destekleniyor', 'success');
            } else {
                log('âš ï¸ Push API desteklenmiyor', 'warn');
            }
            
            setStatus('TarayÄ±cÄ± kontrolÃ¼ tamamlandÄ±', 'success');
        }
        
        function requestPermissionSync() {
            log('Bildirim izni isteniyor (senkron yÃ¶ntem)...', 'info');
            
            if (!('Notification' in window)) {
                log('âŒ Notification API desteklenmiyor', 'error');
                setStatus('TarayÄ±cÄ± bildirimleri desteklemiyor', 'error');
                return;
            }
            
            if (Notification.permission === 'granted') {
                log('âœ… Ä°zin zaten verilmiÅŸ', 'success');
                setStatus('Ä°zin durumu: VerilmiÅŸ', 'success');
                return;
            }
            
            if (Notification.permission === 'denied') {
                log('âŒ Ä°zin reddedilmiÅŸ - TarayÄ±cÄ± ayarlarÄ±ndan manuel olarak aÃ§Ä±n', 'error');
                setStatus('Ä°zin reddedilmiÅŸ - Ayarlardan aÃ§Ä±n', 'error');
                return;
            }
            
            // Synchronous call - Edge requires this
            log('Ä°zin penceresi aÃ§Ä±lÄ±yor...', 'info');
            setStatus('Ä°zin penceresi aÃ§Ä±lÄ±yor...', 'warning');
            
            Notification.requestPermission().then(function(permission) {
                log(`Ä°zin sonucu: ${permission}`, permission === 'granted' ? 'success' : 'error');
                
                if (permission === 'granted') {
                    setStatus('âœ… Bildirim izni verildi!', 'success');
                } else if (permission === 'denied') {
                    setStatus('âŒ Bildirim izni reddedildi', 'error');
                } else {
                    setStatus('â¸ï¸ Ä°zin beklemede', 'warning');
                }
            }).catch(function(error) {
                log(`âŒ Hata: ${error.message}`, 'error');
                setStatus('Ä°zin isteÄŸi baÅŸarÄ±sÄ±z', 'error');
            });
        }
        
        function testNotification() {
            log('Test bildirimi gÃ¶nderiliyor...', 'info');
            
            if (!('Notification' in window)) {
                log('âŒ Notification API desteklenmiyor', 'error');
                setStatus('TarayÄ±cÄ± bildirimleri desteklemiyor', 'error');
                return;
            }
            
            if (Notification.permission !== 'granted') {
                log('âš ï¸ Ã–nce bildirim izni verin', 'warn');
                setStatus('Ã–nce bildirim izni gerekli', 'warning');
                return;
            }
            
            try {
                const notification = new Notification('ğŸ‰ Test BaÅŸarÄ±lÄ±!', {
                    body: 'Edge bildirim sistemi Ã§alÄ±ÅŸÄ±yor',
                    icon: '/static/img/logo.png',
                    badge: '/static/img/badge.png',
                    tag: 'test-notification',
                    requireInteraction: false
                });
                
                notification.onclick = function() {
                    log('Bildirime tÄ±klandÄ±', 'info');
                    notification.close();
                };
                
                log('âœ… Test bildirimi gÃ¶nderildi', 'success');
                setStatus('Test bildirimi gÃ¶nderildi', 'success');
            } catch (error) {
                log(`âŒ Bildirim hatasÄ±: ${error.message}`, 'error');
                setStatus('Bildirim gÃ¶nderilemedi', 'error');
            }
        }
        
        function checkPermissionStatus() {
            log('Ä°zin durumu kontrol ediliyor...', 'info');
            
            if (!('Notification' in window)) {
                log('âŒ Notification API desteklenmiyor', 'error');
                return;
            }
            
            const permission = Notification.permission;
            log(`Mevcut izin durumu: ${permission}`, 'info');
            
            switch (permission) {
                case 'granted':
                    log('âœ… Ä°zin verilmiÅŸ - Bildirimler gÃ¶nderilebilir', 'success');
                    setStatus('Ä°zin durumu: VerilmiÅŸ âœ…', 'success');
                    break;
                case 'denied':
                    log('âŒ Ä°zin reddedilmiÅŸ - TarayÄ±cÄ± ayarlarÄ±ndan aÃ§Ä±n', 'error');
                    log('Edge ayarlarÄ±: edge://settings/content/notifications', 'info');
                    setStatus('Ä°zin durumu: ReddedilmiÅŸ âŒ', 'error');
                    break;
                case 'default':
                    log('â¸ï¸ Ä°zin istenmemiÅŸ - "Bildirim Ä°zni Ä°ste" butonuna tÄ±klayÄ±n', 'warn');
                    setStatus('Ä°zin durumu: Beklemede â¸ï¸', 'warning');
                    break;
            }
        }
        
        // Sayfa yÃ¼klendiÄŸinde otomatik kontrol
        window.addEventListener('load', function() {
            log('Sayfa yÃ¼klendi', 'info');
            checkSupport();
            checkPermissionStatus();
        });
    </script>
</body>
</html>
