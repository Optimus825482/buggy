{% extends "base.html" %}

{% block title %}Lokasyonlar{% endblock %}

{% block header_nav %}
<nav class="nav">
    <a href="{{ url_for('admin.dashboard') }}" class="nav-link">
        <i class="fas fa-home"></i> Dashboard
    </a>
    <a href="{{ url_for('admin.locations') }}" class="nav-link active">
        <i class="fas fa-map-marker-alt"></i> Lokasyonlar
    </a>
    <a href="{{ url_for('admin.buggies') }}" class="nav-link">
        <i class="fas fa-car-alt"></i> Shuttle'lar
    </a>
    <a href="{{ url_for('admin.reports') }}" class="nav-link">
        <i class="fas fa-chart-bar"></i> Raporlar
    </a>
    <a href="#" onclick="logout()" class="nav-link">
        <i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ
    </a>
</nav>
{% endblock %}

{% block content %}
<div class="container" style="padding: 2rem 0;">
    <div class="d-flex justify-between align-center" style="margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
        <h1 style="margin: 0;"><i class="fas fa-map-marker-alt text-primary"></i> Lokasyonlar</h1>
        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <button class="btn btn-secondary" onclick="printAllQRCodes()">
                <i class="fas fa-print"></i> <span class="btn-text">Toplu QR</span>
            </button>
            <button class="btn btn-primary" onclick="showAddLocation()">
                <i class="fas fa-plus"></i> <span class="btn-text">Yeni Lokasyon</span>
            </button>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th style="width: 80px;">GÃ¶rsel</th>
                            <th>Lokasyon AdÄ±</th>
                            <th>AÃ§Ä±klama</th>
                            <th>QR Kod</th>
                            <th>Durum</th>
                            <th>Ä°ÅŸlemler</th>
                        </tr>
                    </thead>
                    <tbody id="locations-table">
                        <tr>
                            <td colspan="6" class="text-center">YÃ¼kleniyor...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/admin.js') }}"></script>
<script>
    // Admin sayfasÄ± olduÄŸunu iÅŸaretle
    document.body.dataset.page = 'admin';
    
    console.log('Locations page script loaded');
    
    // Set hotel ID
    document.body.dataset.hotelId = '{{ session.get("hotel_id", 1) }}';

    // Load locations for this page
    async function loadLocationsPage() {
        console.log('loadLocationsPage called');
        try {
            const response = await ShuttleCall.API.get( '/locations' );
            console.log( 'API Response:', response );
            
            // Handle multiple response formats
            let locations = [];
            if ( response.locations ) {
                locations = response.locations;
            } else if ( response.data && response.data.items ) {
                locations = response.data.items;
            } else if ( response.items ) {
                locations = response.items;
            }
            
            console.log( 'Parsed locations:', locations );

            const tbody = document.getElementById( 'locations-table' );
            if ( !tbody ) return;

            if ( locations.length === 0 ) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">HenÃ¼z lokasyon eklenmemiÅŸ</td></tr>';
                return;
            }

            // Build table rows
            const rows = locations.map( loc => {
                console.log('Building row for location:', loc.name, 'Has image:', !!loc.location_image);
                
                // Ensure we have a valid ID
                const locationId = loc.id || loc.location_id;
                if (!locationId) {
                    console.error('Location missing ID:', loc);
                }
                
                // Create table row element
                const tr = document.createElement('tr');
                
                // Image cell
                const tdImage = document.createElement('td');
                if (loc.location_image && loc.location_image.length > 0) {
                    console.log('Creating image for:', loc.name, 'Image path:', loc.location_image);
                    const img = document.createElement('img');
                    
                    // Resim yolunu tam URL'e Ã§evir
                    let imageUrl = loc.location_image;
                    if (imageUrl.startsWith('/')) {
                        // Relative path ise tam URL yap
                        imageUrl = window.location.origin + imageUrl;
                    } else if (!imageUrl.startsWith('http')) {
                        // Relative path (static/ ile baÅŸlÄ±yor olabilir)
                        imageUrl = window.location.origin + '/' + imageUrl;
                    }
                    console.log('Full image URL:', imageUrl);
                    
                    img.src = imageUrl;
                    img.alt = loc.name;
                    img.style.width = '60px';
                    img.style.height = '60px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '8px';
                    img.style.border = '2px solid #ddd';
                    
                    img.onerror = function() {
                        console.error('Image load error for:', loc.name, 'URL:', imageUrl);
                        // Replace with placeholder on error
                        const placeholder = document.createElement('div');
                        placeholder.style.cssText = 'width: 60px; height: 60px; background: linear-gradient(135deg, #1BA5A8 0%, #158587 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; border: 2px solid #ddd;';
                        placeholder.innerHTML = '<i class="fas fa-map-marker-alt" style="color: white; font-size: 1.5rem;"></i>';
                        tdImage.innerHTML = '';
                        tdImage.appendChild(placeholder);
                    };
                    
                    img.onload = function() {
                        console.log('Image loaded successfully for:', loc.name);
                    };
                    
                    tdImage.appendChild(img);
                } else {
                    console.log('No image for:', loc.name, '- showing placeholder');
                    const placeholder = document.createElement('div');
                    placeholder.style.cssText = 'width: 60px; height: 60px; background: linear-gradient(135deg, #1BA5A8 0%, #158587 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; border: 2px solid #ddd;';
                    placeholder.innerHTML = '<i class="fas fa-map-marker-alt" style="color: white; font-size: 1.5rem;"></i>';
                    tdImage.appendChild(placeholder);
                }
                tr.appendChild(tdImage);
                
                // Name cell
                const tdName = document.createElement('td');
                tdName.innerHTML = `<strong>${escapeHtml(loc.name)}</strong>`;
                tr.appendChild(tdName);
                
                // Description cell
                const tdDesc = document.createElement('td');
                tdDesc.textContent = loc.description || '-';
                tr.appendChild(tdDesc);
                
                // QR Code cell
                const tdQR = document.createElement('td');
                tdQR.innerHTML = `
                    <button class="btn btn-sm btn-info" onclick="showQRCode(${locationId}, '${escapeHtml(loc.name)}', '${loc.qr_code_data || ''}')" title="QR Kodu GÃ¶ster">
                        <i class="fas fa-qrcode"></i> QR
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="quickPrintQR(${locationId}, '${escapeHtml(loc.name)}', '${loc.qr_code_data || ''}')" title="Hemen YazdÄ±r" style="margin-left: 0.25rem;">
                        <i class="fas fa-print"></i>
                    </button>
                `;
                tr.appendChild(tdQR);
                
                // Status cell
                const tdStatus = document.createElement('td');
                tdStatus.innerHTML = `
                    <span class="badge ${loc.is_active ? 'badge-success' : 'badge-secondary'}">
                        ${loc.is_active ? 'Aktif' : 'Pasif'}
                    </span>
                `;
                tr.appendChild(tdStatus);
                
                // Actions cell
                const tdActions = document.createElement('td');
                tdActions.innerHTML = `
                    <button class="btn btn-sm btn-warning" onclick="editLocation(${locationId})" title="DÃ¼zenle">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="deleteLocation(${locationId}, '${escapeHtml(loc.name)}')" title="Sil">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                tr.appendChild(tdActions);
                
                return tr;
            });
            
            // Clear and append rows
            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
        } catch ( error ) {
            console.error( 'Error loading locations:', error );
            const tbody = document.getElementById( 'locations-table' );
            if ( tbody ) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-danger">Lokasyonlar yÃ¼klenemedi</td></tr>';
            }
        }
    }

    // Initialize when page loads
    document.addEventListener( 'DOMContentLoaded', () => {
        Admin.init();
        loadLocationsPage();
    } );

    function showAddLocation() {
        const modal = ShuttleModal.showCustomModal( {
            title: 'Yeni Lokasyon Ekle',
            type: 'info',
            size: 'medium',
            customContent: `
                <form id="location-form">
                    <div class="form-group">
                        <label>Lokasyon AdÄ± *</label>
                        <input type="text" name="name" class="form-control" required placeholder="Ã–rn: Havuz, Plaj, Restaurant">
                    </div>
                    <div class="form-group">
                        <label>AÃ§Ä±klama</label>
                        <textarea name="description" class="form-control" rows="3" placeholder="Lokasyon hakkÄ±nda kÄ±sa aÃ§Ä±klama..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Lokasyon GÃ¶rseli</label>
                        <input type="file" id="location-image-input" class="form-control" accept="image/*" onchange="previewLocationImage(event)">
                        <small class="text-muted">Misafirlerin lokasyonu tanÄ±masÄ± iÃ§in gÃ¶rsel ekleyebilirsiniz (opsiyonel)</small>
                        <div id="image-preview" style="margin-top: 1rem; display: none;">
                            <img id="preview-img" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 2px solid #ddd;">
                        </div>
                    </div>
                </form>
            `,
            buttons: [
                {
                    text: 'Ä°ptal',
                    class: 'btn-secondary',
                    onClick: () => ShuttleModal.closeModal( modal )
                },
                {
                    text: 'Kaydet',
                    class: 'btn-primary',
                    icon: 'fas fa-save',
                    onClick: () => saveLocation( modal )
                }
            ]
        } );
    }

    function previewLocationImage(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('image-preview');
                const img = document.getElementById('preview-img');
                img.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    }

    async function saveLocation( modal ) {
        const form = document.getElementById( 'location-form' );
        const formData = new FormData( form );

        const name = formData.get('name');
        if ( !name || name.trim() === '' ) {
            BuggyCall.Utils.showToast( 'Lokasyon adÄ± gerekli!', 'danger' );
            return;
        }

        // Handle image upload
        const imageInput = document.getElementById('location-image-input');
        if (imageInput && imageInput.files && imageInput.files[0]) {
            const file = imageInput.files[0];
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                BuggyCall.Utils.showToast('GÃ¶rsel boyutu 5MB\'dan kÃ¼Ã§Ã¼k olmalÄ±!', 'danger');
                return;
            }

            // Add file to FormData
            formData.append('location_image', file);
        }

        try {
            console.log( 'Sending location data with FormData' );
            
            // Send FormData directly (multipart/form-data)
            const response = await fetch('/api/locations', {
                method: 'POST',
                body: formData,
                credentials: 'same-origin'
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'Lokasyon eklenemedi');
            }

            const result = await response.json();
            console.log( 'Location created:', result );
            
            BuggyModal.closeModal( modal );
            BuggyCall.Utils.showToast( 'Lokasyon baÅŸarÄ±yla eklendi!', 'success' );

            // Reload locations list
            await loadLocationsPage();

            // Show QR code modal immediately after creation
            const location = result.location || result.data;
            if (location && location.id) {
                setTimeout(() => {
                    showQRCodeAfterCreation(location);
                }, 500);
            }
        } catch ( error ) {
            console.error( 'Location creation error:', error );
            BuggyCall.Utils.showToast( 'Lokasyon eklenemedi: ' + ( error.message || 'Bilinmeyen hata' ), 'danger' );
        }
    }



    function showQRCodeAfterCreation(location) {
        const guestUrl = location.qr_code_data || `${window.location.origin}/guest/call?location=${location.id}`;

        const modal = BuggyModal.showCustomModal( {
            title: `âœ… Lokasyon OluÅŸturuldu - ${location.name}`,
            type: 'success',
            size: 'large',
            customContent: `
                <div style="text-align: center;">
                    <div class="alert alert-success" style="margin-bottom: 1.5rem;">
                        <i class="fas fa-check-circle"></i>
                        <strong>${location.name}</strong> lokasyonu baÅŸarÄ±yla oluÅŸturuldu ve QR kodu hazÄ±r!
                    </div>

                    <div id="qr-code-container" style="margin: 1rem auto; padding: 2rem; background: white; display: inline-block; border: 3px solid #1BA5A8; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <h3 style="margin: 0 0 1rem 0; color: #1BA5A8; font-size: 1.5rem;">
                            <i class="fas fa-map-marker-alt"></i> ${location.name}
                        </h3>
                        <div id="qr-code-canvas"></div>
                        <p style="margin: 1rem 0 0 0; font-size: 1rem; color: #666; font-weight: 600;">
                            Shuttle Call - QR Kod
                        </p>
                    </div>

                    <p class="text-muted" style="margin-top: 1.5rem; font-size: 0.875rem;">
                        <strong>Misafir URL:</strong><br>
                        <code style="font-size: 0.75rem; word-break: break-all; background: #f5f5f5; padding: 0.5rem; border-radius: 4px; display: inline-block; margin-top: 0.5rem;">${guestUrl}</code>
                    </p>

                    <div class="mt-4" style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="printQRCode()" style="min-width: 150px;">
                            <i class="fas fa-print"></i> YazdÄ±r
                        </button>
                        <button class="btn btn-success" onclick="downloadQRCode('${location.name}', '${location.id}')" style="min-width: 150px;">
                            <i class="fas fa-download"></i> PNG Ä°ndir
                        </button>
                    </div>

                    <div class="alert alert-info" style="margin-top: 1.5rem; font-size: 0.875rem;">
                        <i class="fas fa-info-circle"></i>
                        <strong>Ä°pucu:</strong> QR kodu daha sonra lokasyon listesinden de yazdÄ±rabilir veya indirebilirsiniz.
                    </div>
                </div>
            `,
            buttons: [
                {
                    text: 'Tamam',
                    class: 'btn-secondary',
                    onClick: () => BuggyModal.closeModal( modal )
                }
            ]
        } );

        // Generate QR code
        setTimeout( () => {
            const container = document.getElementById( 'qr-code-canvas' );
            if ( container && typeof QRCode !== 'undefined' ) {
                console.log( 'Generating QR code with URL:', guestUrl );
                new QRCode( container, {
                    text: guestUrl,
                    width: 300,
                    height: 300,
                    colorDark: '#000000',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.H
                } );
            }
        }, 100 );
    }

    function showQRCode( id, name, qrData ) {
        console.log( 'showQRCode called:', { id, name, qrData } );

        // qrData is the URL from backend (e.g., http://192.168.1.100:5000/guest/call?location=22)
        const guestUrl = qrData || `${window.location.origin}/guest/call?location=${id}`;

        const modal = BuggyModal.showCustomModal( {
            title: `QR Kod - ${name}`,
            type: 'info',
            size: 'large',
            customContent: `
                <div style="text-align: center;">
                    <div id="qr-code-container" style="margin: 1rem auto; padding: 2rem; background: white; display: inline-block; border: 3px solid #1BA5A8; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <h3 style="margin: 0 0 1rem 0; color: #1BA5A8; font-size: 1.5rem;">
                            <i class="fas fa-map-marker-alt"></i> ${name}
                        </h3>
                        <div id="qr-code-canvas"></div>
                        <p style="margin: 1rem 0 0 0; font-size: 1rem; color: #666; font-weight: 600;">
                            Shuttle Call - QR Kod
                        </p>
                    </div>

                    <p class="text-muted" style="margin-top: 1.5rem; font-size: 0.875rem;">
                        <strong>Misafir URL:</strong><br>
                        <code style="font-size: 0.75rem; word-break: break-all; background: #f5f5f5; padding: 0.5rem; border-radius: 4px; display: inline-block; margin-top: 0.5rem;">${guestUrl}</code>
                    </p>

                    <div class="mt-4" style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="printQRCode()" style="min-width: 150px;">
                            <i class="fas fa-print"></i> YazdÄ±r
                        </button>
                        <button class="btn btn-success" onclick="downloadQRCode('${name}', '${id}')" style="min-width: 150px;">
                            <i class="fas fa-download"></i> PNG Ä°ndir
                        </button>
                    </div>

                    <div class="alert alert-info" style="margin-top: 1.5rem; font-size: 0.875rem;">
                        <i class="fas fa-lightbulb"></i>
                        <strong>Ä°pucu:</strong> QR kodu yazdÄ±rdÄ±ktan sonra lokasyona asabilir veya masa Ã¼zerine koyabilirsiniz.
                    </div>
                </div>
            `,
            buttons: [
                {
                    text: 'Kapat',
                    class: 'btn-secondary',
                    onClick: () => BuggyModal.closeModal( modal )
                }
            ]
        } );

        // Generate QR code using qrcodejs library
        setTimeout( () => {
            const container = document.getElementById( 'qr-code-canvas' );
            if ( container && typeof QRCode !== 'undefined' ) {
                console.log( 'Generating QR code with URL:', guestUrl );
                new QRCode( container, {
                    text: guestUrl,  // Use the URL directly
                    width: 300,
                    height: 300,
                    colorDark: '#000000',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.H
                } );
            } else if ( container ) {
                // Fallback if QRCode library not loaded
                container.innerHTML = '<p style="color: red;">QR kod kÃ¼tÃ¼phanesi yÃ¼klenemedi</p>';
                console.error( 'QRCode library not loaded' );
            }
        }, 100 );
    }

    function escapeHtml( text ) {
        const div = document.createElement( 'div' );
        div.textContent = text;
        return div.innerHTML;
    }

    function downloadQRCode( name, locationId ) {
        const container = document.getElementById( 'qr-code-container' );
        if ( !container ) {
            console.error( 'QR code container not found' );
            return;
        }

        // Use html2canvas to capture the QR code container
        if ( typeof html2canvas !== 'undefined' ) {
            html2canvas( container, {
                backgroundColor: '#ffffff',
                scale: 2
            } ).then( canvas => {
                const link = document.createElement( 'a' );
                link.download = `QR_${name.replace( /[^a-z0-9]/gi, '_' )}.png`;
                link.href = canvas.toDataURL( 'image/png' );
                link.click();
                BuggyCall.Utils.showToast( 'QR kod indirildi!', 'success' );
            } ).catch( error => {
                console.error( 'QR download error:', error );
                BuggyCall.Utils.showToast( 'QR kod indirilemedi', 'danger' );
            } );
        } else {
            console.error( 'html2canvas library not loaded' );
            BuggyCall.Utils.showToast( 'html2canvas kÃ¼tÃ¼phanesi yÃ¼klenemedi', 'danger' );
        }
    }

    function quickPrintQR(id, name, qrData) {
        // Generate QR code in a hidden container and print directly
        const guestUrl = qrData || `${window.location.origin}/guest/call?location=${id}`;

        // Create a temporary container
        const tempDiv = document.createElement('div');
        tempDiv.style.display = 'none';
        tempDiv.id = 'temp-qr-container';
        tempDiv.innerHTML = `
            <div id="temp-qr-code-container" style="padding: 2rem; background: white; display: inline-block; border: 3px solid #1BA5A8; border-radius: 12px; text-align: center;">
                <h3 style="margin: 0 0 1rem 0; color: #1BA5A8; font-size: 1.5rem;">
                    <i class="fas fa-map-marker-alt"></i> ${name}
                </h3>
                <div id="temp-qr-code-canvas"></div>
                <p style="margin: 1rem 0 0 0; font-size: 1rem; color: #666; font-weight: 600;">
                    Shuttle Call - QR Kod
                </p>
            </div>
        `;
        document.body.appendChild(tempDiv);

        // Generate QR code
        setTimeout(() => {
            const canvas = document.getElementById('temp-qr-code-canvas');
            if (canvas && typeof QRCode !== 'undefined') {
                new QRCode(canvas, {
                    text: guestUrl,
                    width: 300,
                    height: 300,
                    colorDark: '#000000',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.H
                });

                // Wait for QR code to render then print
                setTimeout(() => {
                    const container = document.getElementById('temp-qr-code-container');
                    const printWindow = window.open('', '_blank', 'width=800,height=600');
                    printWindow.document.write(`
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <meta charset="UTF-8">
                            <title>QR Kod - ${name}</title>
                            <style>
                                * { margin: 0; padding: 0; box-sizing: border-box; }
                                body {
                                    font-family: 'Inter', 'Arial', sans-serif;
                                    background: white;
                                    display: flex;
                                    justify-content: center;
                                    align-items: center;
                                    min-height: 100vh;
                                    padding: 20px;
                                }
                                .print-container { text-align: center; max-width: 600px; }
                                .qr-container {
                                    padding: 2rem;
                                    background: white;
                                    border: 3px solid #1BA5A8;
                                    border-radius: 12px;
                                    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                                    margin: 0 auto;
                                }
                                .qr-container h3 {
                                    margin: 0 0 1rem 0;
                                    color: #1BA5A8;
                                    font-size: 1.5rem;
                                    font-weight: 700;
                                }
                                .qr-container img, .qr-container canvas {
                                    max-width: 100%;
                                    height: auto;
                                    display: block;
                                    margin: 0 auto;
                                }
                                .qr-container p { margin: 0.5rem 0; color: #666; }
                                .logo {
                                    font-size: 1.25rem;
                                    font-weight: 700;
                                    color: #1BA5A8;
                                    margin-bottom: 0.5rem;
                                }
                                .instructions {
                                    margin-top: 1.5rem;
                                    padding: 1rem;
                                    background: #f8f9fa;
                                    border-radius: 8px;
                                    font-size: 0.875rem;
                                    text-align: left;
                                }
                                .instructions h4 {
                                    color: #1BA5A8;
                                    margin-bottom: 0.5rem;
                                    font-size: 1rem;
                                }
                                .instructions ol { margin-left: 1.5rem; line-height: 1.8; }
                                .footer {
                                    margin-top: 2rem;
                                    padding-top: 1rem;
                                    border-top: 2px dashed #ddd;
                                    font-size: 0.875rem;
                                    color: #999;
                                }
                                @media print {
                                    body { padding: 0; background: white; }
                                    .print-container { max-width: 100%; }
                                    @page { margin: 1cm; size: A4 portrait; }
                                }
                            </style>
                        </head>
                        <body>
                            <div class="print-container">
                                <div class="logo">ðŸš— Shuttle Call</div>
                                ${container.outerHTML}
                                <div class="instructions">
                                    <h4>ðŸ“± NasÄ±l KullanÄ±lÄ±r?</h4>
                                    <ol>
                                        <li>Mobil cihazÄ±nÄ±zdan kamera uygulamasÄ±nÄ± aÃ§Ä±n</li>
                                        <li>QR kodu kameranÄ±za gÃ¶sterin</li>
                                        <li>Ekrana Ã§Ä±kan baÄŸlantÄ±ya dokunun</li>
                                        <li>Buggy talep edin!</li>
                                    </ol>
                                </div>
                                <div class="footer">
                                    <p style="margin-bottom: 0.5rem;"><strong>Shuttle Call</strong> - Otel Ä°Ã§i UlaÅŸÄ±m Sistemi</p>
                                    <p style="font-size: 0.75rem;">Your Ride, On Demand</p>
                                    <p style="font-size: 0.75rem; margin-top: 1rem;">Â© 2025 Powered by </p>
                                </div>
                            </div>
                            <scr` + `ipt>
                                window.onload = function() {
                                    setTimeout(function() { window.print(); }, 500);
                                };
                                window.onafterprint = function() {
                                    setTimeout(function() { window.close(); }, 1000);
                                };
                            </scr` + `ipt>
                        </body>
                        </html>
                    `);
                    printWindow.document.close();

                    // Clean up temp container
                    setTimeout(() => {
                        document.body.removeChild(tempDiv);
                    }, 1000);

                    BuggyCall.Utils.showToast('YazdÄ±rma penceresi aÃ§Ä±lÄ±yor...', 'info');
                }, 300);
            } else {
                BuggyCall.Utils.showToast('QR kod oluÅŸturulamadÄ±!', 'danger');
                document.body.removeChild(tempDiv);
            }
        }, 100);
    }

    function printQRCode() {
        const container = document.getElementById( 'qr-code-container' );
        if ( !container ) {
            BuggyCall.Utils.showToast('QR kod bulunamadÄ±!', 'danger');
            return;
        }

        const printWindow = window.open( '', '_blank', 'width=800,height=600' );
        printWindow.document.write( `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <title>QR Kod YazdÄ±r - Shuttle Call</title>
                <style>
                    * {
                        margin: 0;
                        padding: 0;
                        box-sizing: border-box;
                    }
                    body {
                        font-family: 'Inter', 'Arial', sans-serif;
                        background: white;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        min-height: 100vh;
                        padding: 20px;
                    }
                    .print-container {
                        text-align: center;
                        max-width: 600px;
                    }
                    .qr-container {
                        padding: 2rem;
                        background: white;
                        border: 3px solid #1BA5A8;
                        border-radius: 12px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                        margin: 0 auto;
                    }
                    .qr-container h3 {
                        margin: 0 0 1rem 0;
                        color: #1BA5A8;
                        font-size: 1.5rem;
                        font-weight: 700;
                    }
                    .qr-container img,
                    .qr-container canvas {
                        max-width: 100%;
                        height: auto;
                        display: block;
                        margin: 0 auto;
                    }
                    .qr-container p {
                        margin: 0.5rem 0;
                        color: #666;
                    }
                    .footer {
                        margin-top: 2rem;
                        padding-top: 1rem;
                        border-top: 2px dashed #ddd;
                        font-size: 0.875rem;
                        color: #999;
                    }
                    .logo {
                        font-size: 1.25rem;
                        font-weight: 700;
                        color: #1BA5A8;
                        margin-bottom: 0.5rem;
                    }
                    .instructions {
                        margin-top: 1.5rem;
                        padding: 1rem;
                        background: #f8f9fa;
                        border-radius: 8px;
                        font-size: 0.875rem;
                        text-align: left;
                    }
                    .instructions h4 {
                        color: #1BA5A8;
                        margin-bottom: 0.5rem;
                        font-size: 1rem;
                    }
                    .instructions ol {
                        margin-left: 1.5rem;
                        line-height: 1.8;
                    }
                    @media print {
                        body {
                            padding: 0;
                            background: white;
                        }
                        .print-container {
                            max-width: 100%;
                        }
                        .no-print {
                            display: none !important;
                        }
                        @page {
                            margin: 1cm;
                            size: A4 portrait;
                        }
                    }
                </style>
            </head>
            <body>
                <div class="print-container">
                    <div class="logo">
                        ðŸš— Shuttle Call
                    </div>
                    ${container.outerHTML}

                    <div class="instructions">
                        <h4>ðŸ“± NasÄ±l KullanÄ±lÄ±r?</h4>
                        <ol>
                            <li>Mobil cihazÄ±nÄ±zdan kamera uygulamasÄ±nÄ± aÃ§Ä±n</li>
                            <li>QR kodu kameranÄ±za gÃ¶sterin</li>
                            <li>Ekrana Ã§Ä±kan baÄŸlantÄ±ya dokunun</li>
                            <li>Buggy talep edin!</li>
                        </ol>
                    </div>

                    <div class="footer">
                        <p style="margin-bottom: 0.5rem;"><strong>Shuttle Call</strong> - Otel Ä°Ã§i UlaÅŸÄ±m Sistemi</p>
                        <p style="font-size: 0.75rem;">Your Ride, On Demand</p>
                        <p style="font-size: 0.75rem; margin-top: 1rem;">MERIT INTERNATIONAL HOTELS & RESORTS Â© 2025 COPYRIGHT</p>
                    </div>
                </div>
                <scr` + `ipt>
                    window.onload = function() {
                        setTimeout(function() { window.print(); }, 500);
                    };
                    window.onafterprint = function() {
                        setTimeout(function() { window.close(); }, 1000);
                    };
                </scr` + `ipt>
            </body>
            </html>
        ` );
        printWindow.document.close();

        BuggyCall.Utils.showToast('YazdÄ±rma penceresi aÃ§Ä±lÄ±yor...', 'info');
    }

    async function editLocation( id ) {
        try {
            console.log('editLocation called with ID:', id, 'Type:', typeof id);
            
            // Validate ID
            if (!id || id === 'undefined' || id === 'null') {
                console.error('Invalid location ID:', id);
                BuggyCall.Utils.showToast('GeÃ§ersiz lokasyon ID!', 'danger');
                return;
            }
            
            // Fetch location data
            const response = await BuggyCall.API.get( `/locations/${id}` );
            console.log('Location response:', response);
            
            // Handle different response formats
            let location = null;
            if (response.location) {
                location = response.location;
            } else if (response.data && response.data.location) {
                location = response.data.location;
            } else if (response.data) {
                location = response.data;
            } else {
                location = response;
            }

            console.log('Parsed location:', location);

            if ( !location || !location.name ) {
                BuggyCall.Utils.showToast('Lokasyon bulunamadÄ±!', 'danger');
                return;
            }

            // Escape HTML to prevent XSS
            const safeName = escapeHtml(location.name || '');
            const safeDescription = escapeHtml(location.description || '');
            
            const modalContent = `
                <form id="edit-location-form">
                    <div class="form-group">
                        <label>Lokasyon AdÄ± *</label>
                        <input type="text" id="edit-name" value="${safeName}" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>AÃ§Ä±klama</label>
                        <textarea id="edit-description" rows="3" class="form-control">${safeDescription}</textarea>
                    </div>
                    <div class="form-group">
                        <label>Lokasyon GÃ¶rseli</label>
                        ${location.location_image ? `
                            <div id="current-image-container" style="margin-bottom: 1rem;">
                                <img src="${escapeHtml(location.location_image)}" style="max-width: 100%; max-height: 150px; border-radius: 8px; border: 2px solid #ddd;" onerror="this.style.display='none'">
                                <button type="button" onclick="removeEditImage()" class="btn btn-sm btn-danger" style="margin-top: 0.5rem;">
                                    <i class="fas fa-trash"></i> GÃ¶rseli KaldÄ±r
                                </button>
                            </div>
                        ` : ''}
                        <input type="file" id="edit-location-image" class="form-control" accept="image/*" onchange="previewEditImage(event)">
                        <small class="text-muted">Yeni gÃ¶rsel yÃ¼klemek iÃ§in seÃ§in (opsiyonel)</small>
                        <div id="edit-image-preview" style="margin-top: 1rem; display: none;">
                            <img id="edit-preview-img" style="max-width: 100%; max-height: 150px; border-radius: 8px; border: 2px solid #ddd;">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-6">
                                <label>Enlem (Latitude)</label>
                                <input type="number" id="edit-latitude" value="${location.latitude !== null && location.latitude !== undefined ? location.latitude : ''}" 
                                       step="0.000001" class="form-control" placeholder="Ã–rn: 36.8969">
                            </div>
                            <div class="col-md-6">
                                <label>Boylam (Longitude)</label>
                                <input type="number" id="edit-longitude" value="${location.longitude !== null && location.longitude !== undefined ? location.longitude : ''}" 
                                       step="0.000001" class="form-control" placeholder="Ã–rn: 30.7133">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>GÃ¶rÃ¼ntÃ¼lenme SÄ±rasÄ±</label>
                        <input type="number" id="edit-display-order" value="${location.display_order !== null && location.display_order !== undefined ? location.display_order : 0}" 
                               min="0" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="edit-is-active" ${location.is_active ? 'checked' : ''}>
                            <span>Aktif</span>
                        </label>
                    </div>
                </form>
            `;

            window.editImageRemoved = false;
            window.removeEditImage = function() {
                window.editImageRemoved = true;
                const container = document.getElementById('current-image-container');
                if (container) {
                    container.style.display = 'none';
                }
                BuggyCall.Utils.showToast('GÃ¶rsel kaldÄ±rÄ±lacak', 'info');
            };

            window.previewEditImage = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('edit-image-preview');
                        const img = document.getElementById('edit-preview-img');
                        img.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            };

            const modal = BuggyModal.showCustomModal({
                title: 'Lokasyon DÃ¼zenle',
                type: 'info',
                size: 'medium',
                customContent: modalContent,
                buttons: [
                    {
                        text: 'Ä°ptal',
                        class: 'btn-secondary',
                        onClick: () => BuggyModal.closeModal(modal)
                    },
                    {
                        text: 'GÃ¼ncelle',
                        class: 'btn-primary',
                        icon: 'fas fa-save',
                        onClick: () => saveLocationEdit(modal, id)
                    }
                ]
            });

        } catch ( error ) {
            console.error( 'Error editing location:', error );
            BuggyCall.Utils.showToast( 'Lokasyon bilgileri yÃ¼klenirken hata oluÅŸtu: ' + error.message, 'danger' );
        }
    }

    async function saveLocationEdit(modal, id) {
        const name = document.getElementById( 'edit-name' ).value.trim();
        const description = document.getElementById( 'edit-description' ).value.trim();
        const latitude = document.getElementById( 'edit-latitude' ).value;
        const longitude = document.getElementById( 'edit-longitude' ).value;
        const displayOrder = parseInt( document.getElementById( 'edit-display-order' ).value ) || 0;
        const isActive = document.getElementById( 'edit-is-active' ).checked;

        if ( !name ) {
            BuggyCall.Utils.showToast( 'Lokasyon adÄ± boÅŸ olamaz!', 'danger' );
            return;
        }

        // Check if we have a file to upload
        const imageInput = document.getElementById('edit-location-image');
        const hasFile = imageInput && imageInput.files && imageInput.files[0];

        if (hasFile || window.editImageRemoved) {
            // Use FormData for file upload or image removal
            const formData = new FormData();
            formData.append('name', name);
            formData.append('description', description);
            formData.append('display_order', displayOrder);
            formData.append('is_active', isActive ? 'true' : 'false');

            if ( latitude ) formData.append('latitude', parseFloat(latitude));
            if ( longitude ) formData.append('longitude', parseFloat(longitude));

            // Handle image update
            if (window.editImageRemoved) {
                formData.append('location_image', '');
            } else if (hasFile) {
                const file = imageInput.files[0];
                
                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    BuggyCall.Utils.showToast('GÃ¶rsel boyutu 5MB\'dan kÃ¼Ã§Ã¼k olmalÄ±!', 'danger');
                    return;
                }

                formData.append('location_image', file);
            }

            try {
                const response = await fetch(`/api/locations/${id}`, {
                    method: 'PUT',
                    body: formData,
                    credentials: 'same-origin'
                    // Don't set Content-Type header - browser will set it automatically with boundary
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Lokasyon gÃ¼ncellenemedi');
                }

                BuggyModal.closeModal(modal);
                BuggyCall.Utils.showToast( 'Lokasyon baÅŸarÄ±yla gÃ¼ncellendi!', 'success' );
                loadLocationsPage();
            } catch ( error ) {
                console.error('Update error:', error);
                BuggyCall.Utils.showToast( 'Lokasyon gÃ¼ncellenemedi: ' + ( error.message || 'Bilinmeyen hata' ), 'danger' );
            }
        } else {
            // Use JSON for simple updates without file
            const data = {
                name: name,
                description: description,
                display_order: displayOrder,
                is_active: isActive
            };

            if ( latitude ) data.latitude = parseFloat(latitude);
            if ( longitude ) data.longitude = parseFloat(longitude);

            try {
                const response = await fetch(`/api/locations/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data),
                    credentials: 'same-origin'
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Lokasyon gÃ¼ncellenemedi');
                }

                BuggyModal.closeModal(modal);
                BuggyCall.Utils.showToast( 'Lokasyon baÅŸarÄ±yla gÃ¼ncellendi!', 'success' );
                loadLocationsPage();
            } catch ( error ) {
                console.error('Update error:', error);
                BuggyCall.Utils.showToast( 'Lokasyon gÃ¼ncellenemedi: ' + ( error.message || 'Bilinmeyen hata' ), 'danger' );
            }
        }
    }

    async function editLocation(locationId) {
        try {
            // Load location data
            const response = await BuggyCall.API.get(`/locations/${locationId}`);
            const location = response.data.location;
            
            const modal = BuggyModal.showCustomModal({
                title: 'Lokasyonu DÃ¼zenle',
                type: 'info',
                size: 'medium',
                customContent: `
                    <form id="edit-location-form">
                        <input type="hidden" name="location_id" value="${location.id}">
                        
                        <div class="form-group">
                            <label>Lokasyon AdÄ± *</label>
                            <input type="text" name="name" class="form-control" required value="${escapeHtml(location.name)}">
                        </div>
                        
                        <div class="form-group">
                            <label>AÃ§Ä±klama</label>
                            <textarea name="description" class="form-control" rows="3">${escapeHtml(location.description || '')}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Lokasyon GÃ¶rseli</label>
                            <input type="file" id="edit-location-image-input" class="form-control" accept="image/*" onchange="previewEditLocationImage(event)">
                            <small class="text-muted">Yeni gÃ¶rsel yÃ¼klemek iÃ§in seÃ§in (opsiyonel)</small>
                            
                            ${location.location_image ? `
                                <div id="current-image-preview" style="margin-top: 1rem;">
                                    <p><strong>Mevcut GÃ¶rsel:</strong></p>
                                    <img src="${location.location_image}" style="max-width: 100%; max-height: 150px; border-radius: 8px; border: 2px solid #ddd;">
                                    <button type="button" class="btn btn-sm btn-danger" onclick="removeCurrentImage()" style="margin-top: 0.5rem;">
                                        <i class="fas fa-trash"></i> GÃ¶rseli KaldÄ±r
                                    </button>
                                </div>
                            ` : ''}
                            
                            <div id="edit-image-preview" style="margin-top: 1rem; display: none;">
                                <p><strong>Yeni GÃ¶rsel:</strong></p>
                                <img id="edit-preview-img" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 2px solid #ddd;">
                            </div>
                        </div>
                        
                        <div class="form-group" style="background: #FEF3C7; padding: 1rem; border-radius: 8px; border-left: 4px solid #F59E0B;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: #92400E;">
                                <input type="checkbox" name="regenerate_qr" id="regenerate-qr-checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                                <span>ðŸ”„ QR Kodu Yenile (Kaydet ile birlikte)</span>
                            </label>
                            <small style="display: block; margin-top: 0.5rem; color: #92400E;">
                                <i class="fas fa-info-circle"></i> 
                                <strong>Not:</strong> Lokasyon adÄ± deÄŸiÅŸtiÄŸinde QR kod otomatik yenilenir. 
                                Sadece QR'Ä± yenilemek iÃ§in alttaki sarÄ± butonu kullanÄ±n.
                            </small>
                        </div>
                    </form>
                `,
                buttons: [
                    {
                        text: 'Ä°ptal',
                        class: 'btn-secondary',
                        onClick: () => BuggyModal.closeModal(modal)
                    },
                    {
                        text: 'ðŸ”„ QR Kodu Yenile',
                        class: 'btn-warning',
                        icon: 'fas fa-sync-alt',
                        onClick: () => regenerateQRCode(locationId, modal)
                    },
                    {
                        text: 'Kaydet',
                        class: 'btn-primary',
                        icon: 'fas fa-save',
                        onClick: () => updateLocation(locationId, modal)
                    }
                ]
            });
        } catch (error) {
            console.error('Error loading location:', error);
            BuggyCall.Utils.showToast('Lokasyon yÃ¼klenemedi', 'danger');
        }
    }

    function previewEditLocationImage(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('edit-image-preview');
                const img = document.getElementById('edit-preview-img');
                img.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    }

    function removeCurrentImage() {
        const currentPreview = document.getElementById('current-image-preview');
        if (currentPreview) {
            currentPreview.innerHTML = '<p class="text-muted"><i class="fas fa-info-circle"></i> GÃ¶rsel kaldÄ±rÄ±lacak</p>';
        }
        // Mark for removal
        const form = document.getElementById('edit-location-form');
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'remove_image';
        input.value = 'true';
        form.appendChild(input);
    }

    async function updateLocation(locationId, modal) {
        const form = document.getElementById('edit-location-form');
        const formData = new FormData(form);
        
        const name = formData.get('name');
        if (!name || name.trim() === '') {
            BuggyCall.Utils.showToast('Lokasyon adÄ± gerekli!', 'danger');
            return;
        }
        
        // Add regenerate_qr flag
        const regenerateQR = document.getElementById('regenerate-qr-checkbox').checked;
        formData.append('regenerate_qr', regenerateQR ? 'true' : 'false');
        
        // Handle image removal
        if (formData.get('remove_image') === 'true') {
            formData.append('location_image', '');
        }
        
        try {
            const response = await fetch(`/api/locations/${locationId}`, {
                method: 'PUT',
                body: formData,
                credentials: 'same-origin'
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'Lokasyon gÃ¼ncellenemedi');
            }
            
            const result = await response.json();
            
            BuggyModal.closeModal(modal);
            
            if (result.qr_regenerated) {
                BuggyCall.Utils.showToast('Lokasyon ve QR kod baÅŸarÄ±yla gÃ¼ncellendi!', 'success');
            } else {
                BuggyCall.Utils.showToast('Lokasyon baÅŸarÄ±yla gÃ¼ncellendi!', 'success');
            }
            
            loadLocationsPage();
        } catch (error) {
            console.error('Update error:', error);
            BuggyCall.Utils.showToast('Lokasyon gÃ¼ncellenemedi: ' + (error.message || 'Bilinmeyen hata'), 'danger');
        }
    }

    async function regenerateQRCode(locationId, modal) {
        const confirmed = await BuggyModal.confirm(
            'QR kodu yenilemek istediÄŸinize emin misiniz? Eski QR kodlar geÃ§ersiz olacaktÄ±r.',
            'QR Kodu Yenile',
            'Evet, Yenile',
            'Ä°ptal'
        );
        
        if (!confirmed) return;
        
        try {
            const response = await fetch(`/api/locations/${locationId}/regenerate-qr`, {
                method: 'POST',
                credentials: 'same-origin'
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'QR kod yenilenemedi');
            }
            
            const result = await response.json();
            const location = result.location;
            
            BuggyModal.closeModal(modal);
            BuggyCall.Utils.showToast('QR kod baÅŸarÄ±yla yenilendi!', 'success');
            
            // Show new QR code
            setTimeout(() => {
                showQRCode(location.id, location.name, location.qr_code_data);
            }, 500);
            
            loadLocationsPage();
        } catch (error) {
            console.error('QR regeneration error:', error);
            BuggyCall.Utils.showToast('QR kod yenilenemedi: ' + (error.message || 'Bilinmeyen hata'), 'danger');
        }
    }

    async function deleteLocation( id, name ) {
        const confirmed = await BuggyModal.confirm(
            `"${name}" lokasyonunu silmek istediÄŸinize emin misiniz? Bu iÅŸlem geri alÄ±namaz ve bu lokasyona ait tÃ¼m QR kodlar geÃ§ersiz olacaktÄ±r.`,
            'Lokasyonu Sil',
            'Evet, Sil',
            'Ä°ptal'
        );

        if ( confirmed ) {
            try {
                await BuggyCall.API.delete( `/locations/${id}` );
                BuggyCall.Utils.showToast( 'Lokasyon baÅŸarÄ±yla silindi!', 'success' );
                loadLocationsPage();
            } catch ( error ) {
                console.error( 'Delete location error:', error );
                // Show the error message from the API
                const errorMsg = error.message || 'Bilinmeyen hata';
                await BuggyModal.error( errorMsg );
            }
        }
    }

    function printAllQRCodes() {
        window.open( '/admin/qr-print', '_blank', 'width=1024,height=768' );
    }

    async function logout() {
        const confirmed = await BuggyModal.confirm(
            'Oturumunuzu kapatmak istediÄŸinize emin misiniz?',
            'Ã‡Ä±kÄ±ÅŸ Yap',
            'Evet, Ã‡Ä±kÄ±ÅŸ Yap',
            'Ä°ptal'
        );

        if ( confirmed ) {
            window.location.href = '/auth/logout';
        }
    }
</script>

<style>
    /* Responsive optimizasyonlar */
    @media (max-width: 768px) {
        .container {
            padding: 1rem 0.75rem !important;
        }

        .d-flex.justify-between {
            flex-direction: column;
            align-items: stretch !important;
        }

        .d-flex.justify-between h1 {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
        }

        .d-flex.justify-between > div {
            width: 100%;
        }

        .btn {
            flex: 1;
            justify-content: center;
        }

        /* Table optimize */
        .table-responsive {
            margin: 0 -0.75rem;
            padding: 0 0.75rem;
        }

        .table th,
        .table td {
            padding: 0.5rem;
            font-size: 0.875rem;
        }

        /* GÃ¶rsel sÃ¼tunu kÃ¼Ã§Ã¼lt */
        .table th:first-child {
            width: 60px;
        }

        .table td:first-child img,
        .table td:first-child div {
            width: 50px !important;
            height: 50px !important;
        }

        /* AÃ§Ä±klama sÃ¼tununu gizle */
        .table th:nth-child(3),
        .table td:nth-child(3) {
            display: none;
        }

        /* Action buttons kÃ¼Ã§Ã¼lt */
        .table .btn-sm {
            padding: 0.375rem 0.5rem;
            font-size: 0.75rem;
            margin: 0.125rem;
        }

        .table .btn-sm i {
            font-size: 0.875rem;
        }

        /* Badge kÃ¼Ã§Ã¼lt */
        .badge {
            font-size: 0.625rem;
            padding: 0.25rem 0.5rem;
        }
    }

    @media (max-width: 480px) {
        .container {
            padding: 0.75rem 0.5rem !important;
        }

        .d-flex.justify-between h1 {
            font-size: 1.25rem;
        }

        .btn-text {
            display: none;
        }

        .btn {
            padding: 0.5rem 0.75rem;
        }

        /* Table daha kompakt */
        .table th,
        .table td {
            padding: 0.375rem 0.25rem;
            font-size: 0.8125rem;
        }

        /* GÃ¶rsel daha kÃ¼Ã§Ã¼k */
        .table th:first-child {
            width: 50px;
        }

        .table td:first-child img,
        .table td:first-child div {
            width: 40px !important;
            height: 40px !important;
        }

        /* Durum sÃ¼tununu da gizle */
        .table th:nth-child(5),
        .table td:nth-child(5) {
            display: none;
        }

        /* Action buttons daha kÃ¼Ã§Ã¼k */
        .table .btn-sm {
            padding: 0.25rem 0.375rem;
        }

        .table .btn-sm i {
            font-size: 0.75rem;
        }
    }
</style>
{% endblock %}